<div class="min-h-screen bg-gradient-to-br from-blue-50 to-indigo-100 p-4">
  <div class="max-w-6xl mx-auto">
    <!-- Header -->
    <div class="bg-white rounded-xl shadow-lg p-6 mb-6">
      <div class="flex items-center justify-between">
        <div>
          <h1 class="text-3xl font-bold text-gray-800 mb-2">üå§Ô∏è Weather AI Chat</h1>
          <p class="text-gray-600">Chat with your AI weather assistant</p>
        </div>
        <div class="flex items-center space-x-4">
          <!-- Session Info -->
          <div *ngIf="currentSession" class="text-sm text-gray-600">
            Session: {{currentSession.session_id.substring(0, 8)}}...
          </div>
        </div>
      </div>
    </div>

    <div class="grid grid-cols-1 lg:grid-cols-4 gap-6">
      <!-- Chat Interface -->
      <div class="lg:col-span-3">
        <div class="bg-white rounded-xl shadow-lg h-[600px] flex flex-col">
          <!-- Chat Header -->
          <div class="p-4 border-b border-gray-200 flex items-center justify-between">
            <h3 class="text-lg font-semibold text-gray-800">Chat</h3>
            <div class="flex items-center space-x-2">
              <button 
                (click)="createNewSession()" 
                class="bg-blue-600 hover:bg-blue-700 text-white px-4 py-2 rounded-lg transition-colors duration-200 text-sm"
              >
                New Chat
              </button>
              <button 
                (click)="showSessionList = !showSessionList" 
                class="bg-gray-600 hover:bg-gray-700 text-white px-4 py-2 rounded-lg transition-colors duration-200 text-sm"
              >
                Sessions
              </button>
            </div>
          </div>

          <!-- Messages Container -->
          <div 
            #chatContainer
            class="flex-1 overflow-y-auto p-4 space-y-4"
            [class.bg-gray-50]="messages.length === 0"
          >
            <!-- Empty State -->
            <div *ngIf="displayedMessages.length === 0" class="flex items-center justify-center h-full">
              <div class="text-center">
                <div class="text-6xl mb-4">üå§Ô∏è</div>
                <h3 class="text-xl font-semibold text-gray-700 mb-2">Welcome to Weather AI!</h3>
                <p class="text-gray-600 mb-4">Ask me anything about the weather</p>
                <div class="space-y-2 text-sm text-gray-500">
                  <p>‚Ä¢ "What's the weather like in London?"</p>
                  <p>‚Ä¢ "Will it rain tomorrow in Tokyo?"</p>
                  <p>‚Ä¢ "Should I bring an umbrella to New York?"</p>
                  <p>‚Ä¢ "What's the forecast for Paris this weekend?"</p>
                </div>
              </div>
            </div>

            <!-- Messages -->
            <div *ngFor="let message of displayedMessages" class="flex items-start space-x-2" [class.flex-row-reverse]="message.role === 'user'" [class.space-x-reverse]="message.role === 'user'">
              <!-- Avatar -->
              <div class="flex-shrink-0 w-10 h-10 rounded-full flex items-center justify-center text-lg font-semibold"
                   [class.bg-blue-300]="message.role === 'user'"
                   [class.text-white]="message.role === 'user'"
                   [class.bg-gray-200]="message.role === 'assistant'"
                   [class.text-gray-600]="message.role === 'assistant'">
                <span *ngIf="message.role === 'user'">üë§</span>
                <span *ngIf="message.role === 'assistant'">ü§ñ</span>
              </div>
              
              <!-- Message Content -->
              <div 
                class="max-w-[80%] p-3 rounded-lg"
                [class.bg-blue-200]="message.role === 'user'"
                [class.text-black]="message.role === 'user'"
                [class.bg-gray-100]="message.role === 'assistant'"
                [class.text-gray-800]="message.role === 'assistant'"
              >
                <div 
                  class="whitespace-pre-wrap" 
                  [innerHTML]="formatMessageContent(message.content)"
                  (click)="message.role === 'assistant' && typewriterActive && message === displayedMessages[displayedMessages.length - 1] ? skipTypewriter() : null"
                  [class.cursor-pointer]="message.role === 'assistant' && typewriterActive && message === displayedMessages[displayedMessages.length - 1]"
                >
                  <span *ngIf="message.role === 'assistant' && typewriterActive && message === displayedMessages[displayedMessages.length - 1]" class="animate-pulse">|</span>
                </div>
                <div 
                  class="text-xs mt-1"
                  [class.text-gray-600]="message.role === 'user'"
                  [class.text-gray-500]="message.role === 'assistant'"
                >
                  {{formatTimestamp(message.timestamp)}}
                </div>
              </div>
            </div>

            <!-- Loading Indicator -->
            <div *ngIf="loading" class="flex items-start space-x-2">
              <!-- Avatar -->
              <div class="flex-shrink-0 w-10 h-10 rounded-full bg-gray-200 flex items-center justify-center text-lg font-semibold text-gray-600">
                ü§ñ
              </div>
              
              <!-- Loading Content -->
              <div class="bg-gray-100 p-3 rounded-lg">
                <div class="flex items-center space-x-2">
                  <div class="animate-spin rounded-full h-4 w-4 border-b-2 border-gray-600"></div>
                  <span class="text-gray-600">AI is thinking...</span>
                </div>
              </div>
            </div>
          </div>

          <!-- Input Area -->
          <div class="p-4 border-t border-gray-200">
            <div class="flex space-x-2">
              <input
                #messageInput
                [(ngModel)]="userMessage"
                (keypress)="onKeyPress($event)"
                [disabled]="loading"
                placeholder="Ask about the weather..."
                class="flex-1 p-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent disabled:bg-gray-100"
              />
              <button
                (click)="sendMessage()"
                [disabled]="!userMessage.trim() || loading"
                class="bg-blue-600 hover:bg-blue-700 disabled:bg-gray-400 text-white px-6 py-3 rounded-lg transition-colors duration-200"
              >
                Send
              </button>
            </div>
          </div>
        </div>
      </div>

      <!-- Sidebar -->
      <div class="lg:col-span-1">

        <!-- Sessions List -->
        <div class="bg-white rounded-xl shadow-lg p-6">
          <div class="flex items-center justify-between mb-4">
            <h3 class="text-lg font-semibold text-gray-800">üí¨ Sessions</h3>
            <button 
              (click)="cleanupSessions()" 
              class="text-xs text-gray-500 hover:text-gray-700"
            >
              Cleanup
            </button>
          </div>
          
          <div class="space-y-2 max-h-64 overflow-y-auto">
            <div *ngFor="let session of sessions" class="space-y-2">
              <div 
                class="p-3 border rounded-lg cursor-pointer transition-colors duration-200"
                [class.bg-blue-50]="currentSession?.session_id === session.session_id"
                [class.border-blue-200]="currentSession?.session_id === session.session_id"
                [class.bg-gray-50]="currentSession?.session_id !== session.session_id"
                [class.border-gray-200]="currentSession?.session_id !== session.session_id"
                (click)="loadSession(session.session_id)"
              >
                <div class="flex items-center justify-between">
                  <div class="flex-1 min-w-0">
                    <p class="text-sm font-medium text-gray-800 truncate">
                      {{session.session_id.substring(0, 8)}}...
                    </p>
                    <p class="text-xs text-gray-500 truncate">
                      {{getSessionPreview(session)}}
                    </p>
                    <p class="text-xs text-gray-400">
                      {{session.messages.length}} messages
                    </p>
                  </div>
                  <button 
                    (click)="deleteSession(session.session_id); $event.stopPropagation()"
                    class="text-red-500 hover:text-red-700 text-xs ml-2"
                  >
                    ‚úï
                  </button>
                </div>
              </div>
            </div>
            
            <div *ngIf="sessions.length === 0" class="text-center text-gray-500 text-sm py-4">
              No sessions yet
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- Error Display -->
    <div *ngIf="error" class="fixed bottom-4 right-4 bg-red-100 border border-red-400 text-red-700 px-4 py-3 rounded-lg shadow-lg max-w-md">
      <div class="flex items-center justify-between">
        <span class="text-sm">{{error}}</span>
        <button (click)="error = ''" class="ml-4 text-red-500 hover:text-red-700">‚úï</button>
      </div>
    </div>
  </div>
</div>
